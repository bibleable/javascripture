<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<script src="data/bible.js"></script>
		<script src="data/morphhb.js"></script>
        <script src="data/tischendorf.js"></script>
		<script>
            var javascripture = { data: {} };
			var data = Object.assign( {}, morphhb, tischendorf );
		</script>
        <script src="data/literalConsistent.js"></script>
        <script src="data/lemmas.js"></script>
        <script src="data/literalConsistentExtra.js"></script>
        <script>
		var words = {};
        function getWordFromWord( word ) {
			if ( word && word.length > 0 ) {
			    return word[0];
			}
			
			return null;
		}
		function getLemmaFromWord( word ) {
			if ( word && word.length > 0 ) {
			    return word[1];
			}
			
			return null;
		}

        function getMorphFromWord( word ) {
			if ( word && word.length > 0 ) {
			    return word[2];
			}
			
			return null;
        }
        
        function ConvertToCSV( words ) {
            var str = '';

            Object.keys( words ).forEach( lemma => {
                Object.keys( words[ lemma ] ).forEach( morph => {
                    str += lemma + ','
                    str += morph + ','
                    str += words[ lemma ][ morph ]
                    str += '<br />';
                } );
            } );

            return str;
        }
		
		function generateCSV() {
            var books = ['Daniel'];
            books.forEach( book => data[ book ].forEach( ( chapter, chapterNumber ) => chapter.forEach( ( verse, verseNumber ) => verse.forEach( word => {
                const wordString = getWordFromWord( word );
                const lemma = getLemmaFromWord( word );
                const morph = getMorphFromWord( word )
                if ( lemma ) {
                    wordArray = wordString.split('/');
                    lemmaArray = lemma.split('/');
                    morphArray = morph.split('/');
                    lemmaArray.forEach( ( lemmaInArray, key ) =>  {
                        if ( ! words[ lemmaInArray ] ) {
                            words[ lemmaInArray ] = {};
                        }
                        if ( morphArray[ key ] ) {
                            words[ lemmaInArray ][ morphArray[ key ] ] = javascripture.data.literalConsistent[ lemmaInArray ][ morphArray[ key ] ];
                        } else {
                            words[ lemmaInArray ][ 'no-morph' ] = javascripture.data.literalConsistent[ lemmaInArray ][ 'no-morph' ];
                        }
                    } )
                }
            } ) ) ) );
            //console.log( ConvertToCSV( words ) );
            //document.getElementById('results').innerHTML = JSON.stringify( words );
            document.getElementById('results').innerHTML = ConvertToCSV( words );
			/*var results = words.map( ( word, key ) => {
				return word
			} ).join('<br />');*/
			//document.getElementById('results').innerHTML = results;
		}
		</script>
	</head>
	<body>
		<H1>CSV creator</h1>
		<p>This tool creates a CSV of every lemma and morphology combination in the original text. Use it to generate a CSV that can be shared with others so the process of creating a literal translation can be shared.</p>
		<button onClick="generateCSV()">Generate CSV</button>
		<br />
		<br />
		<div id="results"></div>
	</body>
</html>